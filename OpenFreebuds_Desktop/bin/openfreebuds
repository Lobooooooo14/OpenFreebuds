#!/usr/bin/env python3
import argparse
import logging
import sys

import openfreebuds_applet
from openfreebuds_applet import tools, platform_tools
from openfreebuds_applet.l18n import t

log_format = "%(levelname)s:%(name)s:%(threadName)s  %(message)s"
description = "Unofficial application to manage HUAWEI FreeBuds device"

# Parse arguments
parser = argparse.ArgumentParser(description=description)
parser.add_argument("--verbose",
                    default=False, action="store_true",
                    help="Print debug log to console")
args = parser.parse_args()

# Check that no other instances are running
if tools.is_running():
    platform_tools.show_message(t("application_running_message"),
                                window_title="OpenFreebuds")
    sys.exit(1)

# Setup logging
if args.verbose:
    logging.basicConfig(level=logging.DEBUG,
                        format=log_format)
else:
    # For pre-releases, log to file in any way
    logfile = tools.get_log_filename()

    print("Log redirected to file " + logfile +
          ". Set --verbose flag to see logs here.")

    logging.basicConfig(level=logging.DEBUG,
                        format=log_format,
                        filename=logfile)

# Start app
openfreebuds_applet.start()
